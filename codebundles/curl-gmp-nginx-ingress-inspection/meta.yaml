commands:
- command: 'gcloud auth activate-service-account --key-file=$GOOGLE_APPLICATION_CREDENTIALS
    && curl -d "query=rate(nginx_ingress_controller_requests{host=''${INGRESS_HOST}'',
    service=''${INGRESS_SERVICE}'', status=~''${ERROR_CODES}''}[${TIME_SLICE}]) >
    0" -H "Authorization: Bearer $(gcloud auth print-access-token)" ''https://monitoring.googleapis.com/v1/projects/${GCP_PROJECT_ID}/location/global/prometheus/api/v1/query''
    | jq -r ''if .data.result[0] then "Host:" + .data.result[0].metric.host + " Ingress:"
    + .data.result[0].metric.ingress + " Namespace:" + .data.result[0].metric.exported_namespace
    + " Service:" + .data.result[0].metric.service else "" end'''
  explanation: '


    This command is used to check if there are any errors codes that have occurred
    in a Kubernetes environment. To do this, it activates the Google Cloud service
    account and authenticates it with a key file. Then it runs a curl command which
    passes a query to the Monitoring API of Google Cloud Platform to extract metrics
    about requests from a specific host and service with a status code matching with
    the provided error codes. Finally, it checks if there are any results, and displays
    relevant details such as host, namespace, service, etc.'
  name: fetch_nginx_ingress_metrics_from_gmp_and_perform_inspection_on_results
- command: 'gcloud auth activate-service-account --key-file=$GOOGLE_APPLICATION_CREDENTIALS
    && curl -d "query=rate(nginx_ingress_controller_requests{host=''${INGRESS_HOST}'',
    service=''${INGRESS_SERVICE}'', status=~''${ERROR_CODES}''}[${TIME_SLICE}]) >
    0" -H "Authorization: Bearer $(gcloud auth print-access-token)" ''https://monitoring.googleapis.com/v1/projects/${GCP_PROJECT_ID}/location/global/prometheus/api/v1/query'''
  explanation: '


    This command is used to authenticate and query requests from the Kubernetes Nginx
    Ingress Controller. It verifies if any error codes have occurred over a set period
    of time for an assigned host/service combination. The variables with ${} signs
    are environment variables that provide information on what error codes, host,
    service, and time interval to monitor.'
  name: fetch_nginx_ingress_metrics_from_gmp_and_perform_inspection_on_results
