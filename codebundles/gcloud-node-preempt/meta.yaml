commands:
- command: gcloud auth activate-service-account --key-file=$GOOGLE_APPLICATION_CREDENTIALS
    && gcloud compute operations list --filter='operationType:(compute.instances.preempted)'
    --format=json --project=${GCP_PROJECT_ID} | jq -r --arg now "$(date -u +%s)" '[.[]
    | select((.startTime | sub("\\.[0-9]+"; "") | strptime("%Y-%m-%dT%H:%M:%S%z")
    | mktime) > ($now | tonumber - (${AGE}*60)))] '
  doc_links: '

    - [Google Cloud authentication](https://cloud.google.com/docs/authentication){:target="_blank"}

    - [Compute Engine operations overview](https://cloud.google.com/compute/docs/overview){:target="_blank"}

    - [Filtering and formatting results in Google Cloud](https://cloud.google.com/sdk/gcloud/reference/topic/filters){:target="_blank"}

    - [Working with time frame in Google Cloud](https://cloud.google.com/logging/docs/view/query-library){:target="_blank"}'
  explanation: This command activates the service account using Google Cloud authentication
    and then lists the compute operations for preempted instances in a specific project,
    filtering and formatting the results in JSON with a specific time frame.
  multi_line_details: '

    # Start by activating the service account with the key file provided in the environment
    variable $GOOGLE_APPLICATION_CREDENTIALS

    gcloud auth activate-service-account --key-file=$GOOGLE_APPLICATION_CREDENTIALS
    &&


    # Then, use gcloud compute to list operations that have the type ''compute.instances.preempted''
    in JSON format and filter them based on project ID

    gcloud compute operations list --filter=''operationType:(compute.instances.preempted)''
    --format=json --project=${GCP_PROJECT_ID} |


    # Use jq to parse the JSON output and filter out entries based on their start
    time

    jq -r --arg now "$(date -u +%s)" ''[.[] | select((.startTime | sub("\\.[0-9]+";
    "") | strptime("%Y-%m-%dT%H:%M:%S%z") | mktime) > ($now | tonumber - (${AGE}*60)))]


    # The command is finished. This multi-line structure helps to better understand
    each step of the command and what it does.

    '
  name: list_all_nodes_in_an_active_prempt_operation_for_gcp_project_gcp_project_id
